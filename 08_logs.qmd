# Les logs {.backgroundTitre}

## Les logs

Pour compléter les différents outils de débogage, il reste un pratique essentielle à présenter qui est **l'écriture des logs**.  
Les logs permettent de tracer l'historique des actions, de suivre le cheminement logique du code R et ainsi de repérer l'origine des bugs/erreurs.  

Cette pratique est tellement répandue et utile qu'il existe de très nombreux packages R : 
[{logger}](https://cran.r-project.org/web/packages/logger/index.html), [{futile.logger}](https://cran.r-project.org/web/packages/futile.logger/index.html), [{logging}](https://cran.r-project.org/web/packages/logging/index.html), [{lgr}](https://cran.r-project.org/web/packages/lgr/index.html), [{loggit}](https://cran.r-project.org/web/packages/loggit/index.html),
[{log4r}](https://cran.r-project.org/web/packages/log4r/index.html) ...  
  

Dans cette présentation, nous allons utiliser le package [{logr}](https://logr.r-sassy.org/index.html).

## Pourquoi logr ?

Le package {logr} présente plusieurs avantages :  
  
- Il est très simple à utiliser  
- Il fournit automatique un en-tête complet très utile au débogage  
- L'horadatage est automatique (utile pour des mesures de performances)  

## logr (1/N)

Avec {logr}, il y a besoin de seulement 3 étapes pour créer un fichier de log :
  
- Ouvrir le fichier de log (avec `log_open()`)  
    - Syntaxe : `log_open(chemin_vers_fichier_log)`  
  
- Ecrire dans le fichier de log (avec `log_print()`)  
    - Syntaxe : `log_print("message à écrire dans la log")`  
  
- Fermer le fichier de log (avec `log_close()`)  
    - Syntaxe : `log_close()`  

## logr (2/N)

Un exemple :  

```{.r}
library(logr)

# Ouverture de la log
log_open("ma_log.log")

log_print("## Lecture des données")
donnees <- readRDS("data/iris.rds")

log_print("## Traitement des données")
resultat <- donnees |> 
  group_by(Species) |> 
  summarise(moy_long_petales = mean(Petal.Length, na.rm = TRUE)) 

# Fermeture de la log
log_close()
```

## logr (3/N)

Renvoie la log suivante (partie 1) :  

```{.r}
========================================================================= 
Log Path: ./log/ma_log.log 
Working Directory: /var/data/nfs/CERISE/00-Espace-Personnel/damien.dotta 
User Name: damien.dotta 
R Version: 4.4.1 (2024-06-14) 
Machine: stats-prod-rstudio-2.zsg.cdpagri.fr x86_64 
Operating System: Linux 4.18.0-372.32.1.el8_6.x86_64 #1 SMP Fri Oct 7 12:35:10 EDT 2022 
Base Packages: stats graphics grDevices utils datasets methods base 
Other Packages: dplyr_1.1.4 logr_1.3.8 common_1.1.3 
Log Start Time: 2025-06-27 14:18:06.072628 
========================================================================= 
```

```{.r}
## Lecture des données 

NOTE: Log Print Time:  2025-06-27 14:18:06.08348 
NOTE: Elapsed Time: 0.00261092185974121 secs 

## Traitement des données 

NOTE: Log Print Time:  2025-06-27 14:18:06.090004 
NOTE: Elapsed Time: 0.00652408599853516 secs 

========================================================================= 
Log End Time: 2025-06-27 14:18:06.120677 
Log Elapsed Time: 0 00:00:00 
========================================================================= 
```


## logr (4/N)


## logr (5/N)


voir /var/data/nfs/CERISE/04-Espace-Echanges/Ordonnancement/requetes_bdni/BDNI_effectifs_bovins.R